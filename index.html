<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡¶´‡ßã‡¶≤‡¶ø‡¶ì</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700;900&family=Outfit:wght@300;400;500;600&family=Cormorant+Garamond:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #1a1a2e; --secondary: #16213e; --accent: #e94560; --gold: #d4af37;
            --text-light: #f1f1f1; --text-muted: #a0a0a0;
            --card-bg: rgba(255, 255, 255, 0.03); --border: rgba(212, 175, 55, 0.2);
        }
        body {
            font-family: 'Outfit', sans-serif;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            color: var(--text-light); min-height: 100vh; overflow-x: hidden;
        }
        body::before {
            content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at 20% 30%, rgba(233, 69, 96, 0.08) 0%, transparent 50%),
                        radial-gradient(circle at 80% 70%, rgba(212, 175, 55, 0.06) 0%, transparent 50%);
            pointer-events: none; z-index: 0;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 40px 20px; position: relative; z-index: 1; }
        
        .config-banner {
            background: linear-gradient(135deg, rgba(233, 69, 96, 0.2), rgba(212, 175, 55, 0.2));
            border: 2px dashed var(--gold);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            text-align: center;
            animation: fadeInDown 0.6s ease-out;
        }
        .config-banner h3 {
            color: var(--gold);
            margin-bottom: 15px;
            font-size: 1.5rem;
        }
        .config-banner p {
            margin-bottom: 15px;
            color: var(--text-muted);
        }
        .config-btn {
            background: linear-gradient(135deg, var(--accent), var(--gold));
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            margin: 5px;
            transition: transform 0.3s ease;
        }
        .config-btn:hover {
            transform: translateY(-3px);
        }
        
        .profile-section {
            text-align: center; padding: 60px 20px; background: var(--card-bg); backdrop-filter: blur(20px);
            border: 1px solid var(--border); border-radius: 30px; margin-bottom: 50px; position: relative; overflow: hidden;
            animation: fadeInUp 0.8s ease-out;
        }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeInDown { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); } }
        
        .profile-image-container { position: relative; width: 180px; height: 180px; margin: 0 auto 30px; z-index: 1; }
        .profile-image-wrapper {
            width: 100%; height: 100%; border-radius: 50%;
            background: linear-gradient(135deg, var(--accent), var(--gold)); padding: 5px;
            animation: pulse 3s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 30px rgba(212, 175, 55, 0.4); }
            50% { box-shadow: 0 0 50px rgba(233, 69, 96, 0.6); }
        }
        .profile-image { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 3px solid var(--primary); }
        
        .profile-name {
            font-family: 'Playfair Display', serif; font-size: 3rem; font-weight: 900;
            background: linear-gradient(135deg, var(--gold), var(--accent));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin-bottom: 10px; display: inline-block;
        }
        .profile-title { font-size: 1.3rem; color: var(--text-muted); margin-bottom: 20px; }
        .profile-bio {
            font-family: 'Cormorant Garamond', serif; font-size: 1.15rem;
            max-width: 700px; margin: 0 auto 30px; line-height: 1.8;
        }
        
        .social-links { display: flex; gap: 20px; justify-content: center; flex-wrap: wrap; }
        .social-link {
            padding: 12px 30px; background: linear-gradient(135deg, rgba(233, 69, 96, 0.2), rgba(212, 175, 55, 0.2));
            border: 1px solid var(--border); border-radius: 50px; font-weight: 500;
            transition: all 0.3s ease; text-decoration: none; color: var(--text-light);
            display: inline-block;
        }
        .social-link:hover {
            background: linear-gradient(135deg, var(--accent), var(--gold));
            transform: translateY(-3px); box-shadow: 0 10px 30px rgba(233, 69, 96, 0.3);
        }
        
        .posts-header {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;
            animation: fadeInUp 0.8s ease-out 0.2s both;
        }
        .posts-title {
            font-family: 'Playfair Display', serif; font-size: 2.5rem; font-weight: 700;
            background: linear-gradient(135deg, var(--gold), var(--accent));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .add-post-btn {
            background: linear-gradient(135deg, var(--accent), var(--gold)); color: white; border: none;
            padding: 15px 35px; border-radius: 50px; font-size: 1.1rem; font-weight: 600;
            cursor: pointer; transition: all 0.3s ease; box-shadow: 0 5px 20px rgba(233, 69, 96, 0.3);
        }
        .add-post-btn:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(233, 69, 96, 0.5); }
        
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(10px); z-index: 1000;
            align-items: center; justify-content: center;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: var(--secondary); border: 1px solid var(--border); border-radius: 30px;
            padding: 40px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto;
        }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .modal-title {
            font-family: 'Playfair Display', serif; font-size: 2rem;
            background: linear-gradient(135deg, var(--gold), var(--accent));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .close-btn {
            background: none; border: none; color: var(--text-muted); font-size: 2rem;
            cursor: pointer; width: 40px; height: 40px;
        }
        .close-btn:hover { color: var(--accent); }
        
        .form-group { margin-bottom: 25px; }
        .form-group label { display: block; margin-bottom: 10px; color: var(--gold); font-weight: 600; }
        .form-group input, .form-group textarea {
            width: 100%; padding: 15px; background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border); border-radius: 15px; color: var(--text-light);
            font-family: inherit; font-size: 1rem;
        }
        .form-group input:focus, .form-group textarea:focus {
            outline: none; border-color: var(--gold); background: rgba(255, 255, 255, 0.08);
        }
        .form-group textarea { min-height: 150px; resize: vertical; }
        #imagePreview { margin-top: 15px; display: none; }
        #imagePreview img { max-width: 100%; border-radius: 15px; border: 1px solid var(--border); }
        
        .submit-btn {
            width: 100%; background: linear-gradient(135deg, var(--accent), var(--gold));
            color: white; border: none; padding: 15px; border-radius: 50px;
            font-size: 1.1rem; font-weight: 600; cursor: pointer;
        }
        .submit-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(233, 69, 96, 0.4); }
        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .posts-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 30px; animation: fadeInUp 0.8s ease-out 0.4s both;
        }
        .post-card {
            background: var(--card-bg); backdrop-filter: blur(20px); border: 1px solid var(--border);
            border-radius: 25px; padding: 0; transition: all 0.4s ease; overflow: hidden;
        }
        .post-card:hover { transform: translateY(-10px); border-color: var(--gold); box-shadow: 0 15px 40px rgba(212, 175, 55, 0.2); }
        .post-image { width: 100%; height: 250px; object-fit: cover; border-radius: 25px 25px 0 0; cursor: pointer; }
        .post-body { padding: 25px 30px; }
        .post-title {
            font-family: 'Playfair Display', serif; font-size: 1.8rem; font-weight: 700;
            color: var(--gold); margin-bottom: 10px; cursor: pointer; line-height: 1.3;
        }
        .post-title:hover { color: var(--accent); }
        .post-date { color: var(--text-muted); font-size: 0.9rem; margin-bottom: 0; }
        
        .post-actions { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; }
        .post-btn {
            background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border);
            color: var(--text-light); padding: 8px 20px; border-radius: 20px;
            cursor: pointer; font-size: 0.9rem;
        }
        .post-btn:hover { background: var(--accent); border-color: var(--accent); transform: translateY(-2px); }
        .delete-btn:hover { background: #dc3545; border-color: #dc3545; }
        
        .post-detail-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.9); backdrop-filter: blur(10px); z-index: 1001;
            align-items: center; justify-content: center; overflow-y: auto; padding: 20px;
        }
        .post-detail-modal.active { display: flex; }
        .post-detail-content {
            background: var(--secondary); border: 1px solid var(--border); border-radius: 30px;
            max-width: 800px; width: 100%; max-height: 90vh; overflow-y: auto; position: relative;
        }
        .post-detail-image { width: 100%; max-height: 500px; object-fit: cover; border-radius: 30px 30px 0 0; }
        .post-detail-body { padding: 40px; }
        .post-detail-title {
            font-family: 'Playfair Display', serif; font-size: 2.5rem; font-weight: 700;
            background: linear-gradient(135deg, var(--gold), var(--accent));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
        }
        .post-detail-date { color: var(--text-muted); font-size: 1rem; margin-bottom: 30px; }
        .post-detail-text { color: var(--text-light); font-size: 1.15rem; line-height: 1.9; margin-bottom: 30px; white-space: pre-wrap; }
        .post-detail-close {
            position: absolute; top: 20px; right: 20px; background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--border); border-radius: 50%; width: 45px; height: 45px;
            display: flex; align-items: center; justify-content: center; cursor: pointer;
            color: white; font-size: 1.5rem; z-index: 10;
        }
        .post-detail-close:hover { background: var(--accent); transform: rotate(90deg); }
        
        .empty-state { text-align: center; padding: 80px 20px; color: var(--text-muted); }
        .empty-state-icon { font-size: 5rem; margin-bottom: 20px; opacity: 0.3; }
        .empty-state-text { font-size: 1.3rem; font-family: 'Playfair Display', serif; }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        .loading-overlay.active {
            display: flex;
        }
        .loading-spinner {
            border: 4px solid rgba(212, 175, 55, 0.3);
            border-top: 4px solid var(--gold);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .profile-name { font-size: 2rem; }
            .posts-title { font-size: 1.8rem; }
            .posts-header { flex-direction: column; gap: 20px; align-items: flex-start; }
            .posts-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <div class="container">
        <div class="config-banner" id="configBanner" style="display: none;">
            <h3>‚öôÔ∏è Supabase ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®</h3>
            <p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ Supabase credentials ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</p>
            <button class="config-btn" onclick="App.openConfigModal()">Configure Now</button>
            <button class="config-btn" onclick="App.migrateFromLocalStorage()">Migrate from LocalStorage</button>
        </div>

        <div class="profile-section">
            <div class="profile-image-container">
                <div class="profile-image-wrapper">
                    <img src="https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=400&h=400&fit=crop" alt="Profile" class="profile-image" id="profileImage">
                </div>
            </div>
            <div class="profile-info">
                <h1 class="profile-name" id="profileName">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ</h1>
                <p class="profile-title" id="profileTitle">‡¶ì‡¶Ø‡¶º‡ßá‡¶¨ ‡¶°‡ßá‡¶≠‡ßá‡¶≤‡¶™‡¶æ‡¶∞ | ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶®‡¶æ‡¶∞ | ‡¶∏‡ßÉ‡¶ú‡¶®‡¶∂‡ßÄ‡¶≤ ‡¶ö‡¶ø‡¶®‡ßç‡¶§‡¶æ‡¶¨‡¶ø‡¶¶</p>
                <p class="profile-bio" id="profileBio">‡¶Ü‡¶Æ‡¶ø ‡¶è‡¶ï‡¶ú‡¶® ‡¶Ü‡¶¨‡ßá‡¶ó‡¶™‡ßç‡¶∞‡¶¨‡¶£ ‡¶∏‡ßÉ‡¶∑‡ßç‡¶ü‡¶ø‡¶ï‡¶∞‡ßç‡¶§‡¶æ ‡¶Ø‡¶ø‡¶®‡¶ø ‡¶™‡ßç‡¶∞‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§‡¶ø ‡¶è‡¶¨‡¶Ç ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶®‡ßá‡¶∞ ‡¶∏‡¶Ç‡¶Æ‡¶ø‡¶∂‡ßç‡¶∞‡¶£‡ßá ‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡¶æ‡¶∏ ‡¶ï‡¶∞‡¶ø‡•§</p>
                <div class="social-links">
                    <a href="mailto:mohammadforhan01@gmail.com" class="social-link">üìß Email</a>
                    <a href="tel:+8801310089919" class="social-link">üìû Phone</a>
                    <a href="https://wa.me/8801310089919" target="_blank" class="social-link">üí¨ WhatsApp</a>
                    <a href="https://facebook.com/yourprofile" target="_blank" class="social-link">üìò Facebook</a>
                </div>
            </div>
        </div>

        <div class="posts-section">
            <div class="posts-header">
                <h2 class="posts-title">‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶™‡ßã‡¶∏‡ßç‡¶ü</h2>
                <button class="add-post-btn" id="addPostBtn">‚ú® ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßã‡¶∏‡ßç‡¶ü</button>
            </div>
            <div class="posts-grid" id="postsGrid"></div>
        </div>
    </div>

    <div class="modal" id="configModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Supabase Configuration</h3>
                <button class="close-btn" onclick="App.closeConfigModal()">&times;</button>
            </div>
            <div>
                <div class="form-group">
                    <label>Supabase URL</label>
                    <input type="text" id="supabaseUrl" placeholder="https://your-project.supabase.co">
                </div>
                <div class="form-group">
                    <label>Supabase Anon Key</label>
                    <input type="text" id="supabaseKey" placeholder="eyJhbGc...">
                </div>
                <button class="submit-btn" onclick="App.saveConfig()">Save Configuration</button>
            </div>
        </div>
    </div>

    <div class="modal" id="postModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßã‡¶∏‡ßç‡¶ü</h3>
                <button class="close-btn" id="closeModalBtn">&times;</button>
            </div>
            <div>
                <div class="form-group">
                    <label>‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ</label>
                    <input type="text" id="postTitle" placeholder="‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®...">
                </div>
                <div class="form-group">
                    <label>‡¶õ‡¶¨‡¶ø (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</label>
                    <input type="file" id="postImage" accept="image/*">
                    <div id="imagePreview"><img id="previewImg"></div>
                </div>
                <div class="form-group">
                    <label>‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü</label>
                    <textarea id="postContent" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ö‡¶ø‡¶®‡ßç‡¶§‡¶æ ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®..."></textarea>
                </div>
                <button class="submit-btn" id="submitPostBtn">‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
        </div>
    </div>

    <div class="post-detail-modal" id="postDetailModal">
        <div class="post-detail-content">
            <div class="post-detail-close" id="closeDetailBtn">&times;</div>
            <div id="postDetailContent"></div>
        </div>
    </div>

    <script>
        const App = (function() {
            let db = null;
            let currentEditId = null;

            function init() {
                checkSupabaseConfig();
                loadProfileData();
                setupEventListeners();
            }

            function checkSupabaseConfig() {
                const url = localStorage.getItem('supabase_url');
                const key = localStorage.getItem('supabase_key');
                
                if (url && key) {
                    try {
                        db = window.supabase.createClient(url, key);
                        document.getElementById('configBanner').style.display = 'none';
                        loadPosts();
                    } catch (e) {
                        console.error('Supabase init:', e);
                        document.getElementById('configBanner').style.display = 'block';
                    }
                } else {
                    document.getElementById('configBanner').style.display = 'block';
                }
            }

            function openConfigModal() {
                document.getElementById('supabaseUrl').value = localStorage.getItem('supabase_url') || '';
                document.getElementById('supabaseKey').value = localStorage.getItem('supabase_key') || '';
                document.getElementById('configModal').classList.add('active');
            }

            function closeConfigModal() {
                document.getElementById('configModal').classList.remove('active');
            }

            async function saveConfig() {
                const url = document.getElementById('supabaseUrl').value.trim();
                const key = document.getElementById('supabaseKey').value.trim();
                
                if (!url || !key) {
                    alert('URL ‡¶è‡¶¨‡¶Ç Key ‡¶¶‡ßÅ‡¶ü‡ßã‡¶á ‡¶¶‡¶ø‡¶®!');
                    return;
                }
                
                try {
                    localStorage.setItem('supabase_url', url);
                    localStorage.setItem('supabase_key', key);
                    
                    db = window.supabase.createClient(url, key);
                    
                    const { data, error } = await db.from('posts').select('count');
                    
                    if (error && error.code === '42P01') {
                        alert('Tables ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®! Setup guide ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®‡•§');
                    } else if (error) {
                        alert('Error: ' + error.message);
                    } else {
                        closeConfigModal();
                        document.getElementById('configBanner').style.display = 'none';
                        loadPosts();
                        alert('‚úÖ ‡¶∏‡¶´‡¶≤!');
                    }
                } catch (e) {
                    alert('Error: ' + e.message);
                }
            }

            async function migrateFromLocalStorage() {
                if (!db) {
                    alert('‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá Configure ‡¶ï‡¶∞‡ßÅ‡¶®!');
                    openConfigModal();
                    return;
                }
                
                if (!confirm('Migrate ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?')) return;
                
                showLoading(true);
                
                try {
                    const posts = JSON.parse(localStorage.getItem('posts') || '[]');
                    
                    for (const post of posts) {
                        await db.from('posts').insert({
                            title: post.title,
                            content: post.content,
                            image_url: post.image || null,
                            created_at: new Date(post.date || Date.now()).toISOString()
                        });
                    }
                    
                    showLoading(false);
                    alert(`‚úÖ ${posts.length} ‡¶ü‡¶ø ‡¶™‡ßã‡¶∏‡ßç‡¶ü migrate ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!`);
                    loadPosts();
                } catch (e) {
                    showLoading(false);
                    alert('Error: ' + e.message);
                }
            }

            async function loadProfileData() {
                if (!db) {
                    document.getElementById('profileName').textContent = localStorage.getItem('profileName') || '‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ';
                    document.getElementById('profileTitle').textContent = localStorage.getItem('profileTitle') || '‡¶ì‡¶Ø‡¶º‡ßá‡¶¨ ‡¶°‡ßá‡¶≠‡ßá‡¶≤‡¶™‡¶æ‡¶∞';
                    document.getElementById('profileBio').textContent = localStorage.getItem('profileBio') || '';
                    return;
                }
                
                try {
                    const { data } = await db.from('profiles').select('*').limit(1).single();
                    
                    if (data) {
                        document.getElementById('profileName').textContent = data.name || '‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ';
                        document.getElementById('profileTitle').textContent = data.title || '‡¶ì‡¶Ø‡¶º‡ßá‡¶¨ ‡¶°‡ßá‡¶≠‡ßá‡¶≤‡¶™‡¶æ‡¶∞';
                        document.getElementById('profileBio').textContent = data.bio || '';
                        
                        if (data.image_url) {
                            document.getElementById('profileImage').src = data.image_url;
                        }
                    }
                } catch (e) {
                    console.error('Load profile:', e);
                }
            }

            async function loadPosts() {
                if (!db) {
                    loadPostsFromLocalStorage();
                    return;
                }
                
                try {
                    const { data: posts, error } = await db
                        .from('posts')
                        .select('*')
                        .order('created_at', { ascending: false });
                    
                    if (error) throw error;
                    
                    displayPosts(posts);
                } catch (e) {
                    console.error('Load posts:', e);
                    loadPostsFromLocalStorage();
                }
            }

            function loadPostsFromLocalStorage() {
                const posts = JSON.parse(localStorage.getItem('posts') || '[]');
                displayPosts(posts);
            }

            function displayPosts(posts) {
                const grid = document.getElementById('postsGrid');
                
                if (!posts || posts.length === 0) {
                    grid.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìù</div><p class="empty-state-text">‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®!</p></div>';
                    return;
                }
                
                grid.innerHTML = '';
                posts.forEach(p => {
                    const card = document.createElement('div');
                    card.className = 'post-card';
                    const imageUrl = p.image_url || p.image;
                    
                    card.innerHTML = `
                        ${imageUrl ? `<img src="${imageUrl}" class="post-image" onclick="App.openDetail('${p.id}')">` : ''}
                        <div class="post-body">
                            <h3 class="post-title" onclick="App.openDetail('${p.id}')">${p.title}</h3>
                            <p class="post-date">${formatDate(p.created_at || p.date)}</p>
                        </div>
                    `;
                    grid.appendChild(card);
                });
            }

            function formatDate(dateString) {
                try {
                    const date = new Date(dateString);
                    return date.toLocaleDateString('bn-BD', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                } catch (e) {
                    return dateString;
                }
            }

            async function openDetail(id) {
                let post = null;
                
                if (db) {
                    const { data } = await db.from('posts').select('*').eq('id', id).single();
                    post = data;
                } else {
                    const posts = JSON.parse(localStorage.getItem('posts') || '[]');
                    post = posts.find(p => p.id == id);
                }
                
                if (!post) return;
                
                const imageUrl = post.image_url || post.image;
                document.getElementById('postDetailContent').innerHTML = `
                    ${imageUrl ? `<img src="${imageUrl}" class="post-detail-image">` : ''}
                    <div class="post-detail-body">
                        <h2 class="post-detail-title">${post.title}</h2>
                        <p class="post-detail-date">${formatDate(post.created_at || post.date)}</p>
                        <p class="post-detail-text">${post.content}</p>
                        <div class="post-actions">
                            <button class="post-btn" onclick="App.editPost('${post.id}'); document.getElementById('postDetailModal').classList.remove('active');">‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ</button>
                            <button class="post-btn delete-btn" onclick="App.deletePost('${post.id}'); document.getElementById('postDetailModal').classList.remove('active');">‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
                        </div>
                    </div>
                `;
                document.getElementById('postDetailModal').classList.add('active');
            }

            async function submitPost() {
                const title = document.getElementById('postTitle').value.trim();
                const content = document.getElementById('postContent').value.trim();
                
                if (!title || !content) {
                    alert('‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶è‡¶¨‡¶Ç ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü ‡¶¶‡¶ø‡¶®!');
                    return;
                }
                
                const submitBtn = document.getElementById('submitPostBtn');
                submitBtn.disabled = true;
                submitBtn.textContent = '‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
                
                try {
                    let imageUrl = null;
                    const file = document.getElementById('postImage').files[0];
                    
                    if (file) {
                        const reader = new FileReader();
                        imageUrl = await new Promise((resolve) => {
                            reader.onload = (e) => resolve(e.target.result);
                            reader.readAsDataURL(file);
                        });
                    }
                    
                    if (db) {
                        if (currentEditId) {
                            await db.from('posts').update({
                                title,
                                content,
                                image_url: imageUrl,
                                updated_at: new Date().toISOString()
                            }).eq('id', currentEditId);
                        } else {
                            await db.from('posts').insert({
                                title,
                                content,
                                image_url: imageUrl
                            });
                        }
                    } else {
                        const posts = JSON.parse(localStorage.getItem('posts') || '[]');
                        const post = {
                            id: currentEditId || Date.now(),
                            title,
                            content,
                            image: imageUrl,
                            date: new Date().toLocaleDateString('bn-BD')
                        };
                        
                        if (currentEditId) {
                            const index = posts.findIndex(p => p.id == currentEditId);
                            if (index !== -1) posts[index] = post;
                        } else {
                            posts.unshift(post);
                        }
                        
                        localStorage.setItem('posts', JSON.stringify(posts));
                    }
                    
                    closeModal();
                    loadPosts();
                } catch (e) {
                    alert('Error: ' + e.message);
                } finally {
                    submitBtn.disabled = false;
                    submitBtn.textContent = '‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®';
                }
            }

            async function deletePost(id) {
                if (!confirm('‡¶Æ‡ßÅ‡¶õ‡¶¨‡ßá‡¶®?')) return;
                
                try {
                    if (db) {
                        await db.from('posts').delete().eq('id', id);
                    } else {
                        let posts = JSON.parse(localStorage.getItem('posts') || '[]');
                        posts = posts.filter(p => p.id != id);
                        localStorage.setItem('posts', JSON.stringify(posts));
                    }
                    
                    loadPosts();
                } catch (e) {
                    alert('Error: ' + e.message);
                }
            }

            async function editPost(id) {
                let post = null;
                
                if (db) {
                    const { data } = await db.from('posts').select('*').eq('id', id).single();
                    post = data;
                } else {
                    const posts = JSON.parse(localStorage.getItem('posts') || '[]');
                    post = posts.find(p => p.id == id);
                }
                
                if (!post) return;
                
                currentEditId = id;
                document.getElementById('postTitle').value = post.title;
                document.getElementById('postContent').value = post.content;
                
                const imageUrl = post.image_url || post.image;
                if (imageUrl) {
                    document.getElementById('previewImg').src = imageUrl;
                    document.getElementById('imagePreview').style.display = 'block';
                }
                
                document.getElementById('postModal').classList.add('active');
            }

            function closeModal() {
                document.getElementById('postModal').classList.remove('active');
                document.getElementById('postTitle').value = '';
                document.getElementById('postContent').value = '';
                document.getElementById('postImage').value = '';
                document.getElementById('imagePreview').style.display = 'none';
                currentEditId = null;
            }

            function showLoading(show) {
                document.getElementById('loadingOverlay').classList.toggle('active', show);
            }

            function setupEventListeners() {
                document.getElementById('addPostBtn').addEventListener('click', () => {
                    currentEditId = null;
                    document.getElementById('postModal').classList.add('active');
                });
                
                document.getElementById('closeModalBtn').addEventListener('click', closeModal);
                document.getElementById('submitPostBtn').addEventListener('click', submitPost);
                
                document.getElementById('closeDetailBtn').addEventListener('click', () => {
                    document.getElementById('postDetailModal').classList.remove('active');
                });
                
                document.getElementById('postImage').addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            document.getElementById('previewImg').src = e.target.result;
                            document.getElementById('imagePreview').style.display = 'block';
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }

            return {
                init,
                openConfigModal,
                closeConfigModal,
                saveConfig,
                migrateFromLocalStorage,
                openDetail,
                editPost,
                deletePost
            };
        })();

        window.addEventListener('DOMContentLoaded', () => App.init());
    </script>
</body>
</html>
